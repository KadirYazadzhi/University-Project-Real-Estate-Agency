/**
 * @file add.h
 * @brief Този файл декларира функции, свързани с добавянето на нови имоти в системата.
 *
 * Той включва функционалности за добавяне на единични или множество имоти,
 * обработка на валидиране на потребителски вход за различни атрибути на имота,
 * и проверка на лимитите за капацитет на системата.
 */

#ifndef ADD_H
#define ADD_H

#include "structs.h" 
#include <limits>    
#include <iostream>  

/**
 * @brief Ръководи потребителя при добавяне на единичен нов имот в системата.
 * @param properties Масив от структури Property, където ще бъде добавен новият имот.
 * @param propertyCount Референция към цяло число, представляващо текущия брой имоти.
 *
 * Тази функция подканва потребителя за всички необходими детайли на имота,
 * валидира входа и добавя имота към масива `properties`.
 */
void addSingleProperty(Property properties[], int& propertyCount);

/**
 * @brief Позволява на потребителя да добавя множество имоти в системата в една сесия.
 * @param properties Масив от структури Property, където ще бъдат добавени новите имоти.
 * @param propertyCount Референция към цяло число, представляващо текущия брой имоти.
 *
 * Тази функция многократно извиква `addSingleProperty`, докато потребителят не реши да спре
 * или докато не бъде достигнат максималният капацитет.
 */
void addMultipleProperties(Property properties[], int& propertyCount);

/**
 * @brief Шаблонна функция за получаване на валидиран числов вход от потребителя.
 * @tparam T Очакваният числов тип (напр. int, double).
 * @param prompt Съобщението, показвано на потребителя при поискване на вход.
 * @param errorMsg Съобщението за грешка, показвано при невалиден вход.
 * @return Валидираната числова стойност, въведена от потребителя.
 *
 * Тази функция осигурява надеждна обработка на входа, като многократно подканва потребителя,
 * докато не бъде въведена валидна числова стойност от указания тип.
 */
template <typename T> T getValidNumericInput(const char* prompt, const char* errorMsg = "Невалиден вход. Опитайте отново: ") {
    T value;
    while (true) {
        std::cout << prompt;
        std::cin >> value;

        if (std::cin.fail()) {
            std::cout << errorMsg;
            std::cin.clear(); 
            
            std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
        } else {
            
            std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
            return value;
        }
    }
}

/**
 * @brief Проверява дали е достигнат максималният брой имоти.
 * @param propertyCount Текущият брой имоти в системата.
 * @return true, ако капацитетът е достигнат, в противен случай false.
 *
 * Предотвратява препълване на буфера и гарантира, че приложението работи в рамките на определените лимити.
 */
bool isCapacityReached(int propertyCount);

/**
 * @brief Санитизира C-стил низ, като премахва водещи/следващи интервали и заменя
 *        множество вътрешни интервали с един интервал.
 * @param str C-стил низът, който да бъде санитизиран.
 *
 * Това помага за стандартизиране на въведените низове за по-добра съгласуваност на данните и функционалност за търсене.
 */
void sanitizeString(char* str);

/**
 * @brief Подканва потребителя за въвеждане на низ и го съхранява в буфер, със санитизация.
 * @param prompt Съобщението, показвано на потребителя при поискване на вход.
 * @param buffer Буферът от символи за съхраняване на входния низ.
 * @param bufferSize Максималният размер на буфера, включително терминиращата нула.
 *
 * Тази функция комбинира подканване на потребителя с надеждна обработка на входния низ,
 * включително санитизация за почистване на входа.
 */
void getValidStringInput(const char* prompt, char* buffer, int bufferSize);

#endif 
