/**
 * @file utils.cpp
 * @brief Имплементация на различни помощни функции за манипулиране на конзолата,
 *        потребителско взаимодействие и системни проверки.
 *
 * Този файл предоставя конкретни имплементации за функции, декларирани в `utils.h`,
 * включително изчистване на конзолата, показване на банери на приложението, осигуряване на съществуване на директория,
 * обработка на валидирани избори от меню и получаване на потребителски потвърждения.
 */

#include <iostream>
#include <limits> 
#include <string> 
#include <cctype> 
#include <cstdlib> 
#include "utils.h"
#include "colors.h" 
#include "localization.h" 

using namespace std;

/**
 * @brief Изчиства екрана на конзолата с помощта на ANSI escape кодове.
 *
 * Тази функция изпраща специфични escape последователности до терминала, за да изчисти
 * съдържанието му и да премести курсора в горния ляв ъгъл.
 * Това осигурява чист интерфейс за навигация в менюто и показване на изхода.
 */
void clearConsole() {
  
  
  cout << "\033[2J\033[1;1H";
}

/**
 * @brief Показва ASCII арт банер за приложението.
 *
 * Тази функция отпечатва предварително дефиниран ASCII арт текст на конзолата,
 * служейки като приветствено съобщение или брандиране на приложението при стартиране
 * или при връщане към основните менюта.
 */
void printBanner() {
  cout << R"(
██████╗ ███████╗ █████╗ ██╗         ███████╗███████╗████████╗ █████╗ ████████╗███████╗     █████╗  ██████╗ ███████╗███╗   ██╗ ██████╗██╗   ██╗
██╔══██╗██╔════╝██╔══██╗██║         ██╔════╝██╔════╝╚══██╔══╝██╔══██╗╚══██╔╝╝██╔════╝    ██╔══██╗██╔════╝ ██╔════╝████╗  ██║██╔════╝╚██╗ ██╔╝
██████╔╝█████╗  ███████║██║         █████╗  ███████╗   ██║   ███████║   ██║   █████╗      ███████║██║  ███╗█████╗  ██╔██╗ ██║██║      ╚████╔╝
██╔══██╗██╔══╝  ██╔══██║██║         ██╔══╝  ╚════██║   ██║   ██╔══██║   ██║   ██╔══╝      ██╔══██║██║   ██║██╔══╝  ██║╚██╗██║██║       ╚██╔╝
██║  ██║███████╗██║  ██║███████╗    ███████╗███████║   ██║   ██║  ██║   ██║   ███████╗    ██║  ██║╚██████╔╝███████╗██║ ╚████║╚██████╗   ██║
╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝╚══════╝    ╚══════╝╚══════╝   ╚═╝   ╚═╝  ╚═╝   ╚═╝   ╚══════╝    ╚═╝  ╚═╝ ╚═════╝ ╚══════╝╚═╝  ╚═══╝ ╚═════╝  ╚═╝
        Информационна система 'Агенция за недвижими имоти'                                                     realestateagency - @kadir_
  )" << endl;
  cout << endl;
}

/**
 * @brief Гарантира, че указаният път до директория съществува, създавайки я при необходимост.
 *
 * Тази функция използва shell командата `mkdir -p` за създаване на директории.
 * Тя е жизненоважна за настройване на необходимата файлова системна структура за съхранение на данни
 * (напр. файлове за възстановяване, логове), преди приложението да се опита да пише в тях.
 * Използването на `mkdir -p` гарантира, че родителските директории също се създават, ако не съществуват,
 * и не се съобщава грешка, ако директорията вече съществува.
 *
 * @param path C-стил низ, представляващ пътя до директорията за проверка/създаване.
 */
void ensureDirectoryExists(const char* path) {
    string command = "mkdir -p "; 
    command += path;
    system(command.c_str()); 
}

/**
 * @brief Подканва потребителя за избор от меню и валидира входа.
 *
 * Тази функция гарантира, че потребителският вход за избор от меню е валидно цяло число
 * в рамките на определен диапазон (`min` и `max`). Тя обработва нецелочислени входове
 * и входове извън обхвата чрез изчистване на състоянието на грешка на `cin` и изхвърляне
 * на невалидни символи, след което връща -1, за да укаже невалиден избор.
 * Подканването за избор е локализирано с помощта на `getTranslatedString`.
 *
 * @param min Минималният валиден цялочислен избор.
 * @param max Максималният валиден цялочислен избор.
 * @return Валидираният цялочислен избор, въведен от потребителя, или -1, ако входът е невалиден.
 */
int getMenuChoice(int min, int max) {
    int choice;
    cout << CYAN << getTranslatedString("ENTER_YOUR_CHOICE") << RESET; 
    cin >> choice;

    
    if (!cin) {
        cin.clear(); 
        choice = -1; 
    }
    
    cin.ignore(numeric_limits<streamsize>::max(), '\n');

    
    if (choice < min || choice > max) {
        return -1; 
    }

    return choice;
}

/**
 * @brief Подканва потребителя за потвърждение с "да" или "не".
 *
 * Тази функция представя локализирано подканване на потребителя, очаквайки един
 * символен вход. Тя преобразува входа в малки букви и връща true, ако
 * входът е 'y' (за да), и false в противен случай. Това се използва за критични
 * операции, където е необходимо съгласие на потребителя, като изтриване на данни или презаписване на файлове.
 *
 * @param prompt C-стил низ, представляващ подканването, което да се покаже на потребителя за потвърждение.
 * @return true, ако потребителят въведе 'y' или 'Y', в противен случай false.
 */
bool getConfirmation(const char* prompt) {
    char option;
    cout << YELLOW << prompt << RESET; 
    cin >> option;

    
    if (!cin) {
        cin.clear(); 
    }

    
    cin.ignore(numeric_limits<streamsize>::max(), '\n');
    
    return (tolower(option) == 'y');
}